<!DOCTYPE html>
<html lang='en'>
  <head>
    <meta charset='utf-8'>
    <title>Web Wishes</title>
    <script src='http://www.w3.org/Tools/respec/respec-w3c-common' async></script>
    <script class='remove'>
      var respecConfig = {
              specStatus:   "unofficial"
          ,   shortName:    "html-web-wishes"
          ,   editors:      [{ name: "Robin Berjon", url: "http://berjon.com/",
                               company: "W3C", companyURL: "http://w3.org/" }]
          ,   wg:           "HTML Working Group"
          ,   wgURI:        "http://www.w3.org/html/wg/"
          ,   wgPublicList: "public-html"
          ,   wgPatentURI:  "http://www.w3.org/2004/01/pp-impl/40318/status"
          ,   edDraftURI:   "http://darobin.github.com/web-wish/"
          ,   license:      "open"
        };
    </script>
  </head>
  <body>
    <section id='abstract'>
      <p>
        This specification defines a mechanism for Web applications to register themselves as
        being able to handle certain specific types of services ("grant wishes") with a user
        agent. Once a service handler is registered, any Web application can then request its
        functionality from the user agent in order to compose the service into itself.
      </p>
      <p>
        For instance, a Web application could register itself as an image editor. When another
        application needs image editing functionality (e.g. a meme generator) then it can 
        instantiate the image editor as part of itself (typically in an <code>iframe</code>). The
        editor is selected based on user preference rather than by hardcoding it. This provides a
        simple yet powerful component model for Web applications.
      </p>
    </section>
    <section id='sotd'>
      <p>
        This specification is a proposed extension specification to HTML and has no official
        standing whatsoever.
      </p>
    </section>
    <section>
      <h2>Introduction</h2>
      <p>
        @@@
      </p>
      <section>
        <h2>Example</h2>
        <p>
          @@@
        </p>
      </section>
    </section>
    <section id='conformance'></section>
    <section>
      <h2>Wish Granter Registration</h2>
      <p>
        A wish granter is registered using the <code>link</code> element, using the <code>wish</code>
        relationship.
      </p>
      <pre class='example'>
&lt;link rel='wish' href='image-editor.json'></pre>
      <p>
        The <code>href</code> attribute points to a JSON document.
      </p>
      <pre class='example'>
{
  name:   "Wunderbar Image Editor"
, action: "edit"
, types:  ["image/*"]
, href:   "editor-implementation.html"
}</pre>
      <p>
        There can be many <code>link</code>s using the <code>wish</code> relationship pointing
        to different descriptions. How user agents handle the services they discover is 
        implementation-specific, but they could simply remember them all and apply some heuristics
        (frequency of visit to the site) to sort them when needed, as well as allow for preferred
        granters.
      </p>
    </section>
    <section>
      <h2>Wishing</h2>
      <p>
        Wishing is done with a very simple API.
      </p>
      <pre class='example'>
var url = navigator.wishFor("edit", "image/webp")
,   iframe = document.getElementById("embed-here")
;
iframe.src = url;
iframe.onload = function () {
    iframe.contentWindow.postMessage({ image: imageData });
};
window.onmessage = function (evt) {
    if (!evt.data || evt.data.type !== "image-edited") return;
    // work with evt.data.image
};
</pre>
      <p>
        The URL returned by <code>navigator.wishFor()</code> has the same properties as Blob URLs.
        It can be used to load an <code>iframe</code>, but also to open a new tab or a new window if
        needed.
      </p>
      <p>
        When loaded, if the UA knows of several possible granters that could respond and doesn't 
        have any reason to just prefer one (this is UA specific) it renders a choice page for
        granter services. (This does not trigger the load event.)
      </p>
      <p>
        When a granter is picked (either directly or through user interaction) it is loaded, and
        the load event is fired. Communication is then entirely carried out using the usual 
        Web Messaging framework.
      </p>
    </section>
    <section>
      <h2>Security Considerations</h2>
      <p>
        Are the attack vectors any different from regular <code>iframe</code>s?
      </p>
    </section>
  </body>
</html>
